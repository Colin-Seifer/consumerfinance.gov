{# ==========================================================================

   sidenav_toc.render()

   ==========================================================================

   Description:

   Creates markup for sidenav table of contents

   ========================================================================== #}

{% macro render() %}
  {{ _render_secondary_navigation() }}
{% endmacro %}

{# ==========================================================================

   _render_secondary_navigation()

   ========================================================================== #}
{% macro _render_secondary_navigation() %}
<nav class="o-report-sidenav o-secondary-navigation o-secondary-navigation__no-children"
     aria-label="Section navigation">
    {% set sec_nav_settings = {
        'label': _('In this section'),
        'is_midtone': true,
        'is_bordered': false,
        'is_expanded': false
    } %}

    {% from 'organisms/expandable.html' import expandable with context %}
    {% call() expandable(sec_nav_settings) %}
        {% import 'molecules/nav-link.html' as nav_link %}
        <h3>Table of Contents</h3>
        <ul class="m-list
                   m-list__unstyled
                   o-secondary-navigation_list
                   o-secondary-navigation_list__parents">
        {%- for section in page.report_sections.all().order_by('pk') %}
            <li class="m-list_item">
                {{ nav_link.render(section.section_header, "#" + section.section_id, true) }}
            {%- if section.children -%}
                <ul class="m-list
                           m-list__unstyled
                           o-secondary-navigation_list
                           o-secondary-navigation_list__children">
                {%- for child in section.children -%}
                    <li class="m-list_item">
                        {{ nav_link.render(child.title, child.url, false) }}
                    </li>
                {%- endfor %}
                </ul>
            {%- endif -%}
            </li>

        {%- endfor %}
        </ul>
    {% endcall %}
</nav>
{% endmacro %}
